name: LangGraph Autoheal

on:
  push:
    paths:
      - 'code/**/*.py'

jobs:
  autoheal:
    runs-on: ubuntu-latest

    steps:
    - name: ‚¨áÔ∏è Checkout Code
      uses: actions/checkout@v3

    - name: üêç Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: üì¶ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: üîç Run Autoheal on Changed Files
      run: |
        for f in $(git diff --name-only HEAD^ HEAD | grep '^code/.*\.py$'); do
          echo "Evaluating $f..."
          python autoheal_graph.py "$f"
        done
      env:
        EVALUATOR_API_URL: ${{ secrets.EVALUATOR_API_URL }}
        EVALUATOR_API_KEY: ${{ secrets.EVALUATOR_API_KEY }}
